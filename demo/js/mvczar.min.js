// MVCzar v0.8.0 by Ben Jackson
//
// https://github.com/BYossarian/MVCzar

var MVCzar=function(){function d(a){this._handlers={};this._observers={};if(a)for(var b in a)if(a.hasOwnProperty(b))this.on(b,a[b])}function k(a){a=a||{};d.call(this,a.events);this._props={};a.initial&&this.set(a.initial,!0);a.setup&&a.setup.call(this)}function g(a){var b=this;a=a||{};d.call(this,a.events);this._defaults=a.defaults;this._setup=a.modelSetup||function(){};a.setup&&a.setup.call(this);this._models=[];a.models&&a.models.forEach(function(a){b.add(a,!0)})}function h(a){a=a||{};d.call(this,
a.events);this.elem=a.elem instanceof HTMLElement?a.elem:"string"===typeof a.elem?document.querySelector(a.elem)||document.createElement("div"):document.createElement("div");this._render=a.render||function(){};a.model&&(this.model=a.model);this._DOMEvents={};this._DOMEventHandler=function(a){var b=this._DOMEvents[a.type];if(b)for(var c=0,d=b.length;c<d;c++)a.target[r](b[c].selector)&&b[c].handler.call(this,a)}.bind(this);if(a.DOMEvents)for(var b=0,c=a.DOMEvents.length;b<c;b++)this.addDOMEvent(a.DOMEvents[b][0],
a.DOMEvents[b][1],a.DOMEvents[b][2]);a.setup&&a.setup.call(this)}var l={};d.prototype.on=function(a,b){this._handlers[a]?this._handlers[a].push(b):this._handlers[a]=[b];return this};d.prototype.off=function(a,b){if(this._handlers[a])if(b)for(var c=this._handlers[a].length;c--;)this._handlers[a][c]===b&&this._handlers[a].splice(c,1);else for(;this._handlers[a].length;)this._handlers[a].pop();return this};d.prototype.addObserver=function(a,b,c){this._observers[b]?this._observers[b].push({observer:a,
handler:c}):this._observers[b]=[{observer:a,handler:c}];return this};d.prototype.removeObserver=function(a,b,c){if(this._observers[b])for(var e=this._observers[b].length;e--;)this._observers[b][e].observer===a&&("undefined"!==typeof c&&this._observers[b][e].handler!==c||this._observers[b].splice(e,1));return this};d.prototype.emit=function(a,b){b=b||{};b.target=this;b.type=a;if(this._handlers[a])for(var c=0,e=this._handlers[a].length;c<e;c++)this._handlers[a][c].call(this,b);if(this._observers[a])for(c=
0,e=this._observers[a].length;c<e;c++)this._observers[a][c].handler.call(this._observers[a][c].observer,b);return this};l.Emitter=d;k.prototype=Object.create(d.prototype);k.prototype.set=function(a,b,c){function e(a,b,c){this.get(a)!==b&&(f={},f.oldValue=this._props[a],f.newValue=b,this._props[a]=b,c||this.emit("change:"+a,f),d=!0)}var d=!1,f=null,g=null;if(a instanceof Object)for(a in g=a,c=!!b,g)g.hasOwnProperty(a)&&(b=g[a],e.call(this,a,b,c));else e.call(this,a,b,c);d&&!c&&this.emit("change");
return this};k.prototype.get=function(a){if("string"===typeof a){if(this._props.hasOwnProperty(a))return this._props[a]}else return JSON.parse(JSON.stringify(this._props))};k.prototype.unset=function(a,b){if(this._props.hasOwnProperty(a)){var c=this._props[a];delete this._props[a];b||(this.emit("change:"+a,{oldValue:c}),this.emit("change"))}return this};k.prototype.toJSON=function(){return this.get()};l.Model=k;g.prototype=Object.create(d.prototype);Object.defineProperty(g.prototype,"length",{get:function(){return this._models.length}});
g.prototype.add=function(a,b){var c=null,e=a instanceof k;if(e)c=a;else{var c={},d;for(d in this._defaults)this._defaults.hasOwnProperty(d)&&(c[d]=this._defaults[d]);if("boolean"!==typeof a)for(d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);else b=a;c=new k({initial:c,setup:this._setup})}this._models.push(c);b||(this.emit("add",{model:c}),e&&c.emit("add",{modelList:this}));return c};g.prototype.remove=function(a,b){for(var c=this._models.length;c--;)this._models[c]===a&&this._models.splice(c,1);b||(this.emit("remove",
{model:a}),a.emit("remove",{modelList:this}));return a};g.prototype.getModelAt=function(a){return this._models[a]};g.prototype.set=function(a,b,c){this._models.forEach(function(e){e.set(a,b,c)});return this};g.prototype.unset=function(a,b){this._models.forEach(function(c){c.unset(a,b)});return this};g.prototype.toJSON=function(){var a=[];this._models.forEach(function(b){a.push(b.toJSON())});return a};g.prototype.forEach=function(a){var b=this;this._models.forEach(function(c,e){a.call(b,c,e,b)});return this};
g.prototype.filter=function(a){var b=this;return this._models.filter(function(c,e){return a.call(b,c,e,b)})};l.ModelList=g;var r=function(a){for(var b=["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],c=b.length;c--;)if(a[b[c]])return b[c]}(HTMLElement.prototype);h.prototype=Object.create(d.prototype);h.prototype.observe=function(a,b,c){a.addObserver&&a.addObserver(this,b,c);return this};h.prototype.unobserve=function(a,b,c){a.removeObserver&&a.removeObserver(this,
b,c);return this};h.prototype.setRender=function(a){this._render=a;return this};h.prototype.render=function(){this._render.apply(this,arguments);return this};h.prototype.addDOMEvent=function(a,b,c){this._DOMEvents[a]&&this._DOMEvents[a].length?this._DOMEvents[a].push({selector:b,handler:c}):(this._DOMEvents[a]=this._DOMEvents[a]||[],this._DOMEvents[a].push({selector:b,handler:c}),this.elem.addEventListener(a,this._DOMEventHandler,!1));return this};h.prototype.removeDOMEvent=function(a,b,c){if(this._DOMEvents[a]){if(b||
c)for(var e=this._DOMEvents[a].length;e--;)this._DOMEvents[a][e].selector===b&&("undefined"!==typeof c&&this._DOMEvents[a][e].handler!==c||this._DOMEvents[a].splice(e,1));else for(;this._DOMEvents[a].length;)this._DOMEvents[a].pop();this._DOMEvents[a].length||this.elem.removeEventListener(a,this._DOMEventHandler,!1)}return this};l.View=h;var s=function(){function a(){return window.location.hash.replace(/^#/,"").replace(/^\//,"").replace(/\/$/,"")}function b(){var a=window.location.pathname.replace(/\/$/,
"");return 0===a.indexOf(m)?a.slice(m.length).replace(/^\//,""):a.replace(/^\//,"")}function c(a){var b=l(),c=b.split("/");b===k&&a?k=0:(k=0,f.emit("route",{oldPath:h,path:"/"+b,route:c}),h!=="/"+b&&f.emit("pathchange",{oldPath:h,path:"/"+b,route:c}),h="/"+b)}var e=!1,g=!1,f=Object.create(d.prototype);d.call(f);var k=0,h="",m="",l,p,q;f.start=function(d){d=d||{};m=d.root||"/";m=m.replace(/^\/?/,"/").replace(/\/?$/,"");var h=a(),n=b();l=(e=!d.useHash)?b:a;p=e?function(a){window.history.pushState(null,
document.title,m+a);c()}:function(a){window.location.hash="#"+a};q=e?function(a){window.history.replaceState(null,document.title,m+a);c()}:function(a){window.location.replace("#"+a)};h&&n?e?window.history.replaceState(null,document.title,m+"/"+n):window.location.replace((m||"/")+"#/"+n):h&&e?window.history.replaceState(null,document.title,m+"/"+h):n&&!e&&window.location.replace((m||"/")+"#/"+n);c(!0);k=l();e?window.addEventListener("popstate",c,!1):window.addEventListener("hashchange",c,!1);f.go=
p;f.replace=q;f.refresh=c;f.getPath=function(){return"/"+l()};g=!0;return f};f.hasStarted=function(){return g};f.go=f.replace=f.refresh=f.getPath=function(){};return f}();l.Router=s;return l}();